<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/styleadpage.css">
  <link rel="shortcut icon" type="image" href="/image/logo.png">
  <title>admin page</title>
  <!-- bootstrap link -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <!--  -->
  <!-- Import bootstrap cdn -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <!-- Import jquery cdn -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous">
  </script>
  <!--  -->
  <style>
    .single_user_order_div {
      width: 90%;
      min-height: 90px;
      margin: 1rem 0 0 0;
      color: #fff;
      position: relative;
      border-radius: 12px;
      border: 1px solid rgb(68, 30, 30);
      background-color: rgb(151, 126, 126);
      box-shadow: 5px 5px 10px black;
      display: flex;
      justify-content: space-between;

    }

    .single_user_order_div:hover {
      background-color: rgb(113, 88, 88);
    }

    .box {
      width: 90%;
    }

    .scrollable-content {
      position: relative;
    }

    .product_top_data_div {
      width: 100%;
      min-height: 100px;
      display: flex;
    }

    .product_img_tag {
      margin: .3rem 0 0 0;
      width: 6rem;
      height: 4.5rem;
      overflow: hidden;
      object-fit: fill;
      overflow: hidden;
      border: 1px solid rgb(74, 28, 28);
      border-radius: 12px;
      box-shadow: 3px 3px 5px black;

    }

    .productImg {
      width: 7rem;
      margin: 0 0 0 -.5rem;
    }

    .product_details_div {
      width: 60%;
      color: #fff;
      text-shadow: 2px 2px 3px black;
      padding: 0 0 0 1rem;
      text-wrap: wrap;

    }

    .name_product {
      text-wrap: wrap;
      font-size: 20px;
      text-transform: capitalize;

    }

    .product_description {
      text-wrap: wrap;
      font-size: 13px;
      margin: -.5rem 0 0 0;


    }

    .add_offer_action {
      color: #e5ffbf;
      text-shadow: 2px 2px 3px black;
      text-wrap: wrap;
      padding: 2.5rem 0 0 2rem;
      font-size: 14px;

    }

    .product_bottom_data_div {
      width: 100%;
      display: flex;
      min-height: 100px;
      padding: 2rem 0 0 0;
    }

    .add_form_offer {
      width: 60%;
      border: 2px solid #fff;
      border-radius: 12px;
      min-height: 10rem;
      margin: 0 auto;
      box-shadow: 3px 3px 5px black;
    }

    .reason_for_return {
      background-color: transparent;
      color: #fff;
      font-size: 12px;
      padding: .5rem 0 0 .5rem;
      width: 80%;
      cursor: pointer;
      border-radius: 12px;
      margin: 1rem 0 0 2rem;
    }

    .reason_for_return::placeholder {
      color: #fff;
    }

    .reason_for_return:focus {
      outline: none;
      cursor: pointer;
    }

    .offer_rate_div {
      width: 80%;
      min-height: 3rem;
      display: flex;
      margin: .5rem 0 0 2rem;
      text-transform: capitalize;
      padding: .1rem 0 0 .5rem;
      color: #c3faa5;
      text-shadow: 2px 2px 3px black;

    }

    .number_input {
      background-color: transparent;
      color: #fff;
      width: 50px;
      height: 30px;
      outline: none;
      text-shadow: 2px 2px 3px black;
      border: .5px solid #9f9f9f;
      border-radius: 5px;
      margin: 0 0 0 .2rem;


    }

    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
      opacity: 1;
    }

    .product_footer_data_div {
      width: 80%;
      margin: .5rem 0 2rem 3rem;
      display: flex;
      min-height: 30px;
    }

    .apply_offer,
    .cancel_offer {
      background-color: transparent;
      border: none;
      outline: none;
      color: rgb(219, 145, 145);
      margin: 0 0 0 3rem;
    }

    .offer_data_div {
      width: 90%;
      min-height: 6rem;
      border-top: 1.5px solid rgb(68, 30, 30);
      border-bottom: 1.5px solid rgb(68, 30, 30);
      border-radius: 5px;
      display: flex;
    }

    .offer_info {
      flex: 0 0 40%;
      padding: 1rem 0 0 1rem;
      color: #fff;
      text-shadow: 2px 2px 3px black;
      text-transform: capitalize;
    }

    .offer_name {
      text-wrap: wrap;
      width: 90%;
    }

    .date_offer {
      color: #c3faa5;
      margin: -.5rem 0 0 2rem
    }

    .offer_rate {
      flex: 0 0 30%;
      text-align: center;
      padding: 2rem 0 0 0;
      color: #b1ff87;
      text-shadow: 2px 2px 3px black;
    }

    .offer_price {
      flex: 0 0 30%;
      display: flex;
      color: #fff;
      text-shadow: 2px 2px 3px black;
      text-align: center;
      padding: 2rem 0 0 2rem;
    }

    .realPice_tag {
      font-size: 13px;
      color: #c1c1c1;
      text-decoration: line-through;
      margin-top: .4rem;

    }

    .newPrice_tag {
      font-size: 18px;
    }
  </style>


</head>

<body>
  <div class="container_main ">
    <!-- left bar  -->
    <div class="sidebar">
      <!-- Your sidebar content goes here -->

      <div class="profile_bar">
        <form class="circle" action="/logout" method="get">
          <img src="/image2/admin.png" alt="Profile Image">
          <p class="admintag">admin </p>
          <button id="logoutbtn" type="submit"><img width="20px" src="/image2/logout.png" alt="logout"></button>
        </form>
      </div>
      <a href="/admin/usermanagement"><button id="toggleButton" class="button action_usermanagement" style=" background-color: rgb(98, 77, 77);">Users</button></a>
      <a href="/admin/productmangement"><button class="button" style=" background-color: rgb(98, 77, 77);">Products</button></a>
      <a href="/admin/categorymanagement"><button class="button" style=" background-color: rgb(98, 77, 77);">Categorys</button></a>
      <a href="/admin/ordermanagement"><button class="button" style=" background-color: rgb(98, 77, 77);">Orders</button></a>
      <button onclick="history.back();" class="button" style=" background-color: rgb(69, 45, 45);">Offers</button>
      <a href="/admin/couponmanagement"><button class="button" style=" background-color: rgb(98, 77, 77);">Coupons</button></a>



    </div>
    <!--  -->


    <form class="search-bar" action="/admin/usermanagement/search" method="get">
      <h1>
        <%= poductData._id %>
      </h1>
    </form>

    <!-- Your scrollable content goes here -->

    <div class="scrollable-content">
      <!--  -->
      <!--  -->
      <div class="box">
        <div class="product_top_data_div">

          <div class="product_img_tag">
            <img src="/<%=poductData.product_image_url[0]%>" alt="" class="productImg">
          </div>
          <div class="product_details_div">
            <p class="name_product">
              <%= poductData.product_name %>
            </p>
            <p class="product_description"><%=poductData.product_description %></p>
            <p class="real_price"><span style="color: #acacac; user-select: none;">Real Price</span><% if(poductData.real_price) {%><%= poductData.real_price %><% }else{ %><%= poductData.product_price %><% } %>  <span style="font-size:11px;"><i class="fa fa-inr" aria-hidden="true"></i>
            </span></p>
          </div>
          <div class="add_offer_action">
            <% if(poductData.offer){%>
            <p style="user-select: none; cursor: pointer; color: rgb(234, 134, 134);" onclick="removeOffer('<%=poductData._id%>')">REMOVE OFFER</p>
            <% }else{ %>
            <p style="user-select: none; cursor: pointer;" onclick="addOffer()">ADD OFFER</p>
            <% } %>
          </div>


        </div>
        <div class="product_bottom_data_div">

          <% if(poductData.offer){%>
          <div class="offer_data_div">
            <div class="offer_info">
              <p class="offer_name">
                <%=poductData.offer.offer_description %>
              </p>
              <p class="date_offer">
                (<%=new Date(poductData.offer.createdAt).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }) %>)
              </p>
            </div>
            <div class="offer_rate">
              <%=poductData.offer.itemOffer%>% OFF
            </div>
            <div class="offer_price">
              <p class="newPrice_tag">
                <%=poductData.product_price %> <i class="fa fa-inr" aria-hidden="true"></i>&nbsp;
              </p>
              <p class="realPice_tag">
                <%=poductData.real_price %> <i class="fa fa-inr" aria-hidden="true"></i>
              </p>
            </div>
          </div>
          <% }else{ %>
          <div class="add_form_offer" style="display: none;">
            <textarea class="reason_for_return" placeholder="Offer Description"></textarea>
            <div class="offer_rate_div">
              offer rate (%) <input type="number" id="quantity" name="quantity" min="1" max="99" autocomplete="off" class="number_input" value="10" onkeydown="return handleKeyPress(event)">
            </div>
            <div class="product_footer_data_div">
              <button class="cancel_offer" onclick="cancelBtn()">CANCEL</button>
              <button class="apply_offer" style="color: #c3faa5;" onclick="applyOffer('<%=poductData._id%>')">APPLY</button>
            </div>
          </div>
          <% } %>


        </div>


      </div>


    </div>



    <div class="errormsg" style="display: none;">
      Fail to connect database check your network !
    </div>



    <!-- ////////////////////////SCRIPT AREA/////////////////////////////// -->
    <!-- removeOffer fetch req -->

    <script>
      function removeOffer(productId) {

        const data = {
          productId,
        };
        console.log(data);
        fetch('/admin/offerdetails/product', {
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
          })
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then(data => {
            if(data.status){
                window.location.reload();
            }
          })
          .catch(e => {
            console.log('There has been a problem with your fetch operation: ' + e.message);
          });

      }
    </script>
    <!-- ______________________ -->
    <!-- offer apply fetch req -->
    <script>
      function applyOffer(productId) {


        const offer_description = document.querySelector(".reason_for_return").value;
        const itemOffer = parseInt(document.querySelector(".number_input").value);

        const data = {
          offer_description,
          itemOffer,
          productId,
        };
        console.log(data);
        fetch('/admin/offerdetails/product', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
          })
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then(data => {
            if(data.status){
                window.location.reload();
            }
          })
          .catch(e => {
            console.log('There has been a problem with your fetch operation: ' + e.message);
          });

      }
    </script>
    <!-- _____________________ -->


    <!-- add offer model  -->
    <script>
      function addOffer() {
        document.querySelector(".add_form_offer").style.display = "block";
      }

      function cancelBtn() {
        document.querySelector(".add_form_offer").style.display = "none";
      }
    </script>
    <!-- ________________ -->


    <!-- status update  -->

    <script>
      function errorMsg() {
        document.querySelector('.errormsg').textContent = data.message;
        document.querySelector('.errormsg').style.display = "block";
        document.querySelector('.errormsg').style.animationPlayState = 'running';

        setTimeout(function() {
          document.querySelector('.errormsg').style.animationPlayState = 'paused';
          document.querySelector('.errormsg').style.animationName = "hide"
          document.querySelector('.errormsg').style.animationPlayState = 'running';
          setTimeout(() => {
            window.location.reload()
          }, 150);
        }, 2000);
      }
    </script>
    <!--           _______          -->

    <!--        copy of id  -->
    <script>
      function copyToClipboard() {
        var orderID = document.getElementById("orderID").innerText;
        navigator.clipboard.writeText(orderID).then(function() {
          console.log('Order ID copied to clipboard');
        }).catch(function(err) {
          console.error('Could not copy text: ', err);
        });
      }
    </script>
    <!-- __________________ -->

    <!-- privent typing  -->
    <script>
      function handleKeyPress(event) {
        // Allow arrow keys (37, 38, 39, 40) and prevent other key inputs
        if (event.keyCode >= 37 && event.keyCode <= 40) {
          return true;
        } else {
          event.preventDefault();
          return false;
        }
      }
    </script>
    <!-- ________________ -->


</body>

</html>